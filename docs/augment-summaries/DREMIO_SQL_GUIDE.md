# Dremio SQL Syntax Guide

This guide provides working SQL examples for Dremio Cloud, tested with the Enhanced Dremio Reporting Server.

## ‚úÖ Working SQL Syntax

### Basic Queries

```sql
-- Simple SELECT with quoted aliases
SELECT 1 "test_value"

-- Multiple columns with different data types
SELECT 1 "number", 'Hello Dremio' "message", LOCALTIMESTAMP "timestamp"

-- Current user and timestamp
SELECT USER "current_user", LOCALTIMESTAMP "current_time"
```

### Schema Discovery

```sql
-- Show all schemas
SHOW SCHEMAS

-- Count total schemas
SELECT COUNT(*) "total_schemas" FROM INFORMATION_SCHEMA.SCHEMATA

-- List schema names
SELECT SCHEMA_NAME "schema_name" FROM INFORMATION_SCHEMA.SCHEMATA LIMIT 10

-- Non-system schemas with catalog info
SELECT SCHEMA_NAME "schema", CATALOG_NAME "catalog" 
FROM INFORMATION_SCHEMA.SCHEMATA 
WHERE SCHEMA_NAME NOT LIKE '%sys%' 
LIMIT 5
```

## üîß Dremio SQL Syntax Rules

### Column Aliases
- ‚úÖ **Use double quotes**: `SELECT 1 "alias_name"`
- ‚ùå **Avoid AS keyword**: `SELECT 1 AS alias_name` (may cause issues)

### Functions
- ‚úÖ **LOCALTIMESTAMP**: Use instead of `CURRENT_TIMESTAMP`
- ‚úÖ **USER**: Use instead of `CURRENT_USER()`
- ‚úÖ **NOW()**: Alternative timestamp function

### String Literals
- ‚úÖ **Single quotes**: `'Hello Dremio'`
- ‚úÖ **Escape quotes**: `'Don''t use this'`

### Available System Tables
- ‚úÖ **INFORMATION_SCHEMA.SCHEMATA**: Schema information
- ‚ùå **INFORMATION_SCHEMA.TABLES**: Not available in this Dremio Cloud instance
- ‚ùå **SYS.Jobs**: Not available via Flight SQL

## üöÄ Performance Results

### Multi-Driver Comparison
Based on testing with the Enhanced Dremio Reporting Server:

| Driver | Status | Performance | Notes |
|--------|--------|-------------|-------|
| **PyArrow Flight SQL** | ‚úÖ Working | ~0.8s | **Recommended** - Fastest and most reliable |
| **ADBC Flight SQL** | ‚ùå Issues | ~18s | Schema compatibility problems with nullable fields |
| **JDBC (JayDeBeApi)** | ‚ö†Ô∏è Available | - | Requires Dremio JDBC driver JAR |
| **PyODBC** | ‚ö†Ô∏è Missing | - | Requires ODBC driver installation |

### Recommendation
**Use PyArrow Flight SQL** for all production queries - it's the fastest and most reliable driver.

## üìä Example Results

### Schema Count
```json
{
  "total_schemas": 53
}
```

### Schema List
```json
[
  {"schema_name": "$scratch"},
  {"schema_name": "@vando.pereira@dremio.com"},
  {"schema_name": "BranchHealth and DevOps"},
  {"schema_name": "dremio-builds"},
  {"schema_name": "Performance"}
]
```

### User Information
```json
{
  "current_user": "vando.pereira@dremio.com",
  "current_time": "Fri, 04 Jul 2025 09:34:08 GMT"
}
```

## üåê Using the Enhanced Dremio Reporting Server

### Web Interface
1. **Main Page**: http://localhost:5000/
2. **SQL Query Interface**: http://localhost:5000/query
3. **Debug Configuration**: http://localhost:5000/debug

### API Endpoints
```bash
# Single driver query
curl -X POST http://localhost:5000/api/query \
  -H "Content-Type: application/json" \
  -d '{"sql": "SELECT USER \"current_user\""}'

# Multi-driver comparison
curl -X POST http://localhost:5000/api/query-multi-driver \
  -H "Content-Type: application/json" \
  -d '{"sql": "SELECT 1 \"test\"", "drivers": ["pyarrow_flight", "adbc_flight"]}'

# Available drivers
curl http://localhost:5000/api/drivers

# Schema discovery
curl http://localhost:5000/api/schemas
```

## ‚ùå Common Errors and Solutions

### Error: "Encountered 'as current_time' at line 1"
**Problem**: Using `AS` keyword or `CURRENT_TIMESTAMP`
```sql
-- ‚ùå Wrong
SELECT 1 as test_value, CURRENT_TIMESTAMP as current_time

-- ‚úÖ Correct
SELECT 1 "test_value", LOCALTIMESTAMP "current_time"
```

### Error: "Encountered '. TABLES' at line 1"
**Problem**: `INFORMATION_SCHEMA.TABLES` not available
```sql
-- ‚ùå Wrong
SELECT * FROM INFORMATION_SCHEMA.TABLES

-- ‚úÖ Correct
SELECT * FROM INFORMATION_SCHEMA.SCHEMATA
```

### Error: "Schema inconsistency: nullable fields"
**Problem**: ADBC Flight SQL driver compatibility
**Solution**: Use PyArrow Flight SQL driver instead

## üéØ Best Practices

1. **Always use PyArrow Flight SQL** for production queries
2. **Use double quotes for aliases**: `"alias_name"`
3. **Test queries in the web interface** before automation
4. **Use LOCALTIMESTAMP** instead of CURRENT_TIMESTAMP
5. **Check available schemas** with `SHOW SCHEMAS` first
6. **Use the debug menu** to test different configurations

## üîß Troubleshooting

If queries fail:
1. Check the **Debug Configuration** menu for connection issues
2. Test with **simple queries first**: `SELECT 1 "test"`
3. Use **PyArrow Flight SQL driver only**
4. Verify **schema names** with `SHOW SCHEMAS`
5. Check **query syntax** against this guide

---

*Generated by the Enhanced Dremio Reporting Server with PyArrow Flight SQL integration*
